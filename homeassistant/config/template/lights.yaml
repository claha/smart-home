---
# yamllint disable rule:line-length
- binary_sensor:
    - name: Dark outside
      state: >
        {% set rising = state_attr("sun.sun", "rising") %}
        {% set elevation = state_attr("sun.sun", "elevation") %}
        {% set up = states("input_number.lights_sun_elevation_up")|float %}
        {% set down = states("input_number.lights_sun_elevation_down")|float %}
        {% set illuminance = states("sensor.illuminance") %}
        {% set illuminance_on = states("input_number.lights_illuminance_on")|float %}
        {% set illuminance_off = states("input_number.lights_illuminance_off")|float %}
        {% if is_number(illuminance) %}
          {% set illuminance = illuminance|float %}
          {% if rising %}
            {{ elevation < up and illuminance < illuminance_off }}
          {% else %}
            {{ elevation < down or illuminance < illuminance_on }}
          {% endif %}
        {% else %}
          {% if rising %}
            {{ elevation < up }}
          {% else %}
            {{ elevation < down }}
          {% endif %}
        {% endif %}

    - name: Lights kitchen
      state: >
        {{ is_state("switch.osram_smart_plug_1", "on") }}

    - name: Lights living room
      state: >
        {{
          is_state("switch.osram_smart_plug_0", "on") or
          is_state("switch.tradfri_control_outlet_0", "on")
        }}

    - name: Lights bedroom
      state: >
        {{
          is_state("switch.tradfri_control_outlet_3", "on")
        }}

    - name: Lights guest room
      state: >
        {{ is_state("switch.tradfri_control_outlet_1", "on") }}

    - name: Lights master bedroom
      state: >
        {{ is_state("light.tradfri_bulb_0", "on") }}

    - name: Lights office
      state: >
        {{
          is_state("switch.tradfri_control_outlet_2", "on")
        }}

- sensor:
    - name: Sun Elevation
      unit_of_measurement: "Â°"
      icon: mdi:angle-acute
      state: "{{ '%+.1f'|format(state_attr('sun.sun', 'elevation')) }}"
