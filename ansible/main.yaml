---
- name: Setup pihole
  hosts: pihole
  vars_files:
    - vars/vault.yaml

  pre_tasks:
    - name: Update cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600
      become: true

  roles:
    - role: geerlingguy.docker
      become: true
      tags:
        - never
        - init
    - role: bash
    - role: docker_compose_pihole
    - role: docker_compose_glances
    - role: docker_compose_tailscale

- name: Setup smarthome
  hosts: smarthome
  vars_files:
    - vars/vault.yaml

  pre_tasks:
    - name: Update cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600
      become: true

  roles:
    - role: geerlingguy.docker
      become: true
      tags:
        - never
        - init
    - role: bash
    - role: docker_compose_piper
    - role: docker_compose_speedtest
    - role: docker_compose_duckdns
    - role: docker_compose_dozzle
    - role: docker_compose_diun
    - role: docker_compose_glances
    - role: docker_compose_tailscale
    - role: docker_compose_mosquitto
    - role: docker_compose_traefik

- name: Setup zigbee
  hosts: zigbee
  vars_files:
    - vars/vault.yaml

  pre_tasks:
    - name: Update cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600
      become: true

  roles:
    - role: geerlingguy.docker
      become: true
      tags:
        - never
        - init
    - role: bash
